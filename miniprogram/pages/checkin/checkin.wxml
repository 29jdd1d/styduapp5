<!--pages/checkin/checkin.wxml-->
<view class="checkin-page">
  <!-- æ‰“å¡ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalDays || 0}}</text>
        <text class="stat-label">ç´¯è®¡æ‰“å¡</text>
      </view>
      <view class="stat-item highlight">
        <text class="stat-value">{{stats.streakDays || 0}}</text>
        <text class="stat-label">è¿ç»­æ‰“å¡</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.maxStreakDays || 0}}</text>
        <text class="stat-label">æœ€é•¿è¿ç»­</text>
      </view>
    </view>
  </view>

  <!-- æ—¥å† -->
  <view class="calendar-card card">
    <view class="calendar-header">
      <view class="calendar-nav" bindtap="prevMonth">â€¹</view>
      <text class="calendar-title">{{currentYear}}å¹´{{currentMonth}}æœˆ</text>
      <view class="calendar-nav" bindtap="nextMonth">â€º</view>
    </view>
    
    <view class="calendar-weekdays">
      <text wx:for="{{weekdays}}" wx:key="*this">{{item}}</text>
    </view>
    
    <view class="calendar-days">
      <view 
        class="calendar-day {{item.isCurrentMonth ? '' : 'other-month'}} {{item.isToday ? 'today' : ''}} {{item.checked ? 'checked' : ''}}"
        wx:for="{{calendarDays}}"
        wx:key="date"
      >
        <text class="day-num">{{item.day}}</text>
        <view class="check-dot" wx:if="{{item.checked}}"></view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ‰“å¡ -->
  <view class="checkin-section card">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥æ‰“å¡</text>
    </view>
    
    <view wx:if="{{todayCheckin}}">
      <view class="checkin-done">
        <text class="done-icon">âœ…</text>
        <text class="done-text">ä»Šæ—¥å·²æ‰“å¡</text>
      </view>
      <view class="checkin-info">
        <text class="info-item">å­¦ä¹ æ—¶é•¿ï¼š{{todayCheckin.duration}}åˆ†é’Ÿ</text>
        <text class="info-item" wx:if="{{todayCheckin.content}}">å­¦ä¹ å†…å®¹ï¼š{{todayCheckin.content}}</text>
      </view>
    </view>
    
    <view wx:else>
      <!-- å­¦ä¹ æ—¶é•¿ -->
      <view class="form-item">
        <text class="form-label">å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</text>
        <input 
          type="number" 
          class="form-input" 
          placeholder="è¯·è¾“å…¥ä»Šæ—¥å­¦ä¹ æ—¶é•¿"
          value="{{duration}}"
          bindinput="onDurationInput"
        />
      </view>
      
      <!-- å­¦ä¹ å†…å®¹ -->
      <view class="form-item">
        <text class="form-label">å­¦ä¹ å†…å®¹ï¼ˆé€‰å¡«ï¼‰</text>
        <textarea 
          class="form-textarea" 
          placeholder="è®°å½•ä¸€ä¸‹ä»Šå¤©å­¦äº†ä»€ä¹ˆ..."
          value="{{content}}"
          bindinput="onContentInput"
          maxlength="200"
        />
      </view>

      <!-- å¿ƒæƒ…é€‰æ‹© -->
      <view class="form-item">
        <text class="form-label">ä»Šæ—¥å¿ƒæƒ…</text>
        <view class="mood-list">
          <view 
            class="mood-item {{mood === index + 1 ? 'active' : ''}}"
            wx:for="{{moods}}"
            wx:key="*this"
            bindtap="selectMood"
            data-mood="{{index + 1}}"
          >{{item}}</view>
        </view>
      </view>

      <!-- æ‰“å¡æŒ‰é’® -->
      <button class="btn btn-primary checkin-btn" bindtap="doCheckin" loading="{{loading}}">
        ç«‹å³æ‰“å¡
      </button>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œå…¥å£ -->
  <view class="ranking-entry card" bindtap="goToRanking">
    <view class="entry-left">
      <text class="entry-icon">ğŸ†</text>
      <text class="entry-text">æ‰“å¡æ’è¡Œæ¦œ</text>
    </view>
    <text class="entry-arrow">â€º</text>
  </view>
</view>
