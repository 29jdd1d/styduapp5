<!--pages/mine/records/records.wxml-->
<view class="records-page">
  <!-- 标签切换 -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentType === 'course' ? 'active' : ''}}"
      bindtap="switchType"
      data-type="course"
    >课程记录</view>
    <view 
      class="tab-item {{currentType === 'practice' ? 'active' : ''}}"
      bindtap="switchType"
      data-type="practice"
    >练习记录</view>
    <view 
      class="tab-item {{currentType === 'exam' ? 'active' : ''}}"
      bindtap="switchType"
      data-type="exam"
    >考试记录</view>
  </view>

  <!-- 记录列表 -->
  <scroll-view 
    class="records-list" 
    scroll-y 
    enhanced 
    show-scrollbar="{{false}}"
    bindscrolltolower="loadMore"
    refresher-enabled
    bindrefresherrefresh="onRefresh"
    refresher-triggered="{{isRefreshing}}"
  >
    <!-- 课程记录 -->
    <block wx:if="{{currentType === 'course'}}">
      <view 
        class="record-card course-record"
        wx:for="{{records}}"
        wx:key="id"
        bindtap="goToCourse"
        data-id="{{item.courseId}}"
      >
        <image class="course-cover" src="{{item.courseCover || '/images/default-cover.png'}}" mode="aspectFill"/>
        <view class="record-info">
          <text class="record-title">{{item.courseTitle}}</text>
          <text class="record-sub">{{item.chapterTitle}} · {{item.videoTitle}}</text>
          <view class="record-meta">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.progress}}%"></view>
            </view>
            <text class="progress-text">{{item.progress}}%</text>
          </view>
          <text class="record-time">{{item.updateTimeStr}}</text>
        </view>
      </view>
    </block>

    <!-- 练习记录 -->
    <block wx:if="{{currentType === 'practice'}}">
      <view 
        class="record-card practice-record"
        wx:for="{{records}}"
        wx:key="id"
      >
        <view class="record-header">
          <text class="record-title">{{item.categoryName || '综合练习'}}</text>
          <text class="record-status {{item.isCompleted ? 'completed' : ''}}">
            {{item.isCompleted ? '已完成' : '进行中'}}
          </text>
        </view>
        <view class="record-stats">
          <view class="stat-item">
            <text class="stat-num">{{item.totalCount}}</text>
            <text class="stat-label">总题数</text>
          </view>
          <view class="stat-item">
            <text class="stat-num correct">{{item.correctCount}}</text>
            <text class="stat-label">正确</text>
          </view>
          <view class="stat-item">
            <text class="stat-num wrong">{{item.wrongCount}}</text>
            <text class="stat-label">错误</text>
          </view>
          <view class="stat-item">
            <text class="stat-num">{{item.accuracy}}%</text>
            <text class="stat-label">正确率</text>
          </view>
        </view>
        <view class="record-footer">
          <text class="record-time">{{item.createTimeStr}}</text>
          <text class="record-duration">用时 {{item.durationStr}}</text>
        </view>
      </view>
    </block>

    <!-- 考试记录 -->
    <block wx:if="{{currentType === 'exam'}}">
      <view 
        class="record-card exam-record"
        wx:for="{{records}}"
        wx:key="id"
        bindtap="goToExamResult"
        data-id="{{item.examId}}"
      >
        <view class="record-header">
          <text class="record-title">{{item.examTitle}}</text>
          <view class="score-badge {{item.passed ? 'pass' : 'fail'}}">
            {{item.score}}分
          </view>
        </view>
        <view class="exam-detail">
          <view class="detail-item">
            <text class="detail-label">满分</text>
            <text class="detail-value">{{item.totalScore}}分</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">及格线</text>
            <text class="detail-value">{{item.passScore}}分</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">用时</text>
            <text class="detail-value">{{item.durationStr}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">排名</text>
            <text class="detail-value">{{item.rank || '-'}}</text>
          </view>
        </view>
        <view class="record-footer">
          <text class="record-time">{{item.submitTimeStr}}</text>
          <text class="view-detail">查看详情 ></text>
        </view>
      </view>
    </block>

    <!-- 空状态 -->
    <view class="empty" wx:if="{{!loading && records.length === 0}}">
      <image class="empty-icon" src="/images/empty.png" mode="aspectFit"/>
      <text class="empty-text">暂无记录</text>
    </view>

    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{records.length > 0}}">
      <text wx:if="{{hasMore}}">加载中...</text>
      <text wx:else>没有更多了</text>
    </view>
  </scroll-view>
</view>
