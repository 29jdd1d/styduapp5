<!--pages/exam/result/result.wxml-->
<view class="result-page">
  <!-- æˆç»©å¡ç‰‡ -->
  <view class="score-card">
    <view class="score-bg"></view>
    <view class="score-content">
      <view class="score-circle {{result.passed ? 'pass' : 'fail'}}">
        <text class="score-num">{{result.score}}</text>
        <text class="score-unit">åˆ†</text>
      </view>
      <view class="score-status">
        <text class="status-icon">{{result.passed ? 'ğŸ‰' : 'ğŸ’ª'}}</text>
        <text class="status-text">{{result.passed ? 'æ­å–œé€šè¿‡' : 'ç»§ç»­åŠ æ²¹'}}</text>
      </view>
      <view class="score-detail">
        <view class="detail-item">
          <text class="detail-label">æ»¡åˆ†</text>
          <text class="detail-value">{{result.totalScore}}åˆ†</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">åŠæ ¼çº¿</text>
          <text class="detail-value">{{result.passScore}}åˆ†</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç”¨æ—¶</text>
          <text class="detail-value">{{result.usedTimeStr}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­”é¢˜ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="section-header">
      <text class="section-title">ç­”é¢˜ç»Ÿè®¡</text>
    </view>
    <view class="stats-grid">
      <view class="stat-card correct">
        <text class="stat-num">{{result.correctCount}}</text>
        <text class="stat-label">ç­”å¯¹</text>
      </view>
      <view class="stat-card wrong">
        <text class="stat-num">{{result.wrongCount}}</text>
        <text class="stat-label">ç­”é”™</text>
      </view>
      <view class="stat-card unanswered">
        <text class="stat-num">{{result.unansweredCount}}</text>
        <text class="stat-label">æœªç­”</text>
      </view>
      <view class="stat-card rate">
        <text class="stat-num">{{result.accuracy}}%</text>
        <text class="stat-label">æ­£ç¡®ç‡</text>
      </view>
    </view>
  </view>

  <!-- é¢˜ç›®è¯¦æƒ… -->
  <view class="detail-section">
    <view class="section-header">
      <text class="section-title">é¢˜ç›®è¯¦æƒ…</text>
      <view class="filter-tabs">
        <text 
          class="filter-tab {{filter === 'all' ? 'active' : ''}}"
          bindtap="setFilter"
          data-filter="all"
        >å…¨éƒ¨</text>
        <text 
          class="filter-tab {{filter === 'wrong' ? 'active' : ''}}"
          bindtap="setFilter"
          data-filter="wrong"
        >é”™é¢˜</text>
      </view>
    </view>

    <view class="question-list">
      <view 
        class="question-item"
        wx:for="{{filteredQuestions}}"
        wx:key="id"
        bindtap="toggleQuestion"
        data-index="{{index}}"
      >
        <view class="question-header">
          <view class="question-num">ç¬¬{{item.index}}é¢˜</view>
          <view class="question-type">{{item.typeText}}</view>
          <view class="question-status {{item.isCorrect ? 'correct' : 'wrong'}}">
            {{item.isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯'}}
          </view>
        </view>

        <view class="question-brief">{{item.content}}</view>

        <view class="question-detail" wx:if="{{item.expanded}}">
          <!-- é€‰é¡¹ -->
          <view class="options-list" wx:if="{{item.options.length > 0}}">
            <view 
              class="option-item {{option.key === item.answer ? 'correct' : ''}} {{option.key === item.userAnswer && option.key !== item.answer ? 'wrong' : ''}}"
              wx:for="{{item.options}}"
              wx:for-item="option"
              wx:key="key"
            >
              <view class="option-key">{{option.key}}</view>
              <text class="option-text">{{option.value}}</text>
            </view>
          </view>

          <view class="answer-info">
            <view class="answer-row">
              <text class="answer-label">æˆ‘çš„ç­”æ¡ˆï¼š</text>
              <text class="answer-value {{item.isCorrect ? 'correct' : 'wrong'}}">{{item.userAnswer || 'æœªä½œç­”'}}</text>
            </view>
            <view class="answer-row">
              <text class="answer-label">æ­£ç¡®ç­”æ¡ˆï¼š</text>
              <text class="answer-value correct">{{item.answer}}</text>
            </view>
          </view>

          <view class="analysis" wx:if="{{item.analysis}}">
            <text class="analysis-label">è§£æï¼š</text>
            <text class="analysis-text">{{item.analysis}}</text>
          </view>
        </view>

        <view class="expand-icon">{{item.expanded ? 'æ”¶èµ·' : 'å±•å¼€'}}</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="bottom-bar">
    <view class="btn-item" bindtap="goBack">
      <text>è¿”å›åˆ—è¡¨</text>
    </view>
    <view class="btn-item primary" bindtap="reviewWrong" wx:if="{{result.wrongCount > 0}}">
      <text>å¤ä¹ é”™é¢˜</text>
    </view>
  </view>
</view>
