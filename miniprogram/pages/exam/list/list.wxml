<!--pages/exam/list/list.wxml-->
<view class="exam-page">
  <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
  <view class="stats-header">
    <view class="stats-bg"></view>
    <view class="stats-content">
      <view class="stats-item">
        <text class="stats-num">{{stats.totalExams || 0}}</text>
        <text class="stats-label">æ€»è€ƒè¯•</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-num">{{stats.completedExams || 0}}</text>
        <text class="stats-label">å·²å®Œæˆ</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-num">{{stats.avgScore || 0}}</text>
        <text class="stats-label">å¹³å‡åˆ†</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾ç­›é€‰ -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === 'all' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="all"
    >å…¨éƒ¨è€ƒè¯•</view>
    <view 
      class="tab-item {{currentTab === 'pending' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="pending"
    >å¾…è€ƒè¯•</view>
    <view 
      class="tab-item {{currentTab === 'completed' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="completed"
    >å·²å®Œæˆ</view>
  </view>

  <!-- è€ƒè¯•åˆ—è¡¨ -->
  <scroll-view 
    class="exam-list" 
    scroll-y 
    enhanced 
    show-scrollbar="{{false}}"
    bindscrolltolower="loadMore"
    refresher-enabled
    bindrefresherrefresh="onRefresh"
    refresher-triggered="{{isRefreshing}}"
  >
    <view 
      class="exam-card"
      wx:for="{{exams}}"
      wx:key="id"
      bindtap="goToExam"
      data-exam="{{item}}"
    >
      <view class="exam-header">
        <text class="exam-title">{{item.title}}</text>
        <view class="exam-status status-{{item.statusCode}}">{{item.statusText}}</view>
      </view>

      <view class="exam-info">
        <view class="info-item">
          <text class="info-icon">ğŸ“</text>
          <text class="info-text">{{item.questionCount}}é“é¢˜</text>
        </view>
        <view class="info-item">
          <text class="info-icon">â±</text>
          <text class="info-text">{{item.duration}}åˆ†é’Ÿ</text>
        </view>
        <view class="info-item">
          <text class="info-icon">ğŸ“Š</text>
          <text class="info-text">æ»¡åˆ†{{item.totalScore}}åˆ†</text>
        </view>
      </view>

      <view class="exam-time">
        <text class="time-label">è€ƒè¯•æ—¶é—´ï¼š</text>
        <text class="time-value">{{item.startTimeStr}} - {{item.endTimeStr}}</text>
      </view>

      <!-- å·²å®Œæˆæ˜¾ç¤ºæˆç»© -->
      <view class="exam-result" wx:if="{{item.myScore !== undefined && item.myScore !== null}}">
        <view class="result-item">
          <text class="result-label">æˆ‘çš„æˆç»©</text>
          <text class="result-score {{item.myScore >= item.passScore ? 'pass' : 'fail'}}">{{item.myScore}}åˆ†</text>
        </view>
        <view class="result-item">
          <text class="result-label">ç”¨æ—¶</text>
          <text class="result-value">{{item.usedTimeStr}}</text>
        </view>
        <view class="result-item">
          <text class="result-label">æ’å</text>
          <text class="result-value">{{item.rank || '-'}}</text>
        </view>
      </view>

      <view class="exam-action">
        <text class="action-btn" wx:if="{{item.statusCode === 'pending'}}">å¼€å§‹è€ƒè¯•</text>
        <text class="action-btn" wx:elif="{{item.statusCode === 'doing'}}">ç»§ç»­è€ƒè¯•</text>
        <text class="action-btn secondary" wx:elif="{{item.statusCode === 'completed'}}">æŸ¥çœ‹è¯¦æƒ…</text>
        <text class="action-btn disabled" wx:else>{{item.statusText}}</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{!loading && exams.length === 0}}">
      <image class="empty-icon" src="/images/empty.png" mode="aspectFit"/>
      <text class="empty-text">æš‚æ— è€ƒè¯•</text>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{exams.length > 0}}">
      <text wx:if="{{hasMore}}">åŠ è½½ä¸­...</text>
      <text wx:else>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </scroll-view>
</view>
