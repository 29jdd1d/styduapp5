<!--pages/community/list/list.wxml-->
<view class="community-page">
  <!-- é¡¶éƒ¨ç­›é€‰æ  -->
  <view class="filter-bar">
    <scroll-view class="filter-scroll" scroll-x enhanced show-scrollbar="{{false}}">
      <view class="filter-list">
        <view 
          class="filter-item {{currentType === '' ? 'active' : ''}}"
          bindtap="onTypeChange"
          data-type=""
        >å…¨éƒ¨</view>
        <view 
          class="filter-item {{currentType === '1' ? 'active' : ''}}"
          bindtap="onTypeChange"
          data-type="1"
        >ç»éªŒåˆ†äº«</view>
        <view 
          class="filter-item {{currentType === '2' ? 'active' : ''}}"
          bindtap="onTypeChange"
          data-type="2"
        >é—®é¢˜æ±‚åŠ©</view>
        <view 
          class="filter-item {{currentType === '3' ? 'active' : ''}}"
          bindtap="onTypeChange"
          data-type="3"
        >èµ„æ–™åˆ†äº«</view>
        <view 
          class="filter-item {{currentType === '4' ? 'active' : ''}}"
          bindtap="onTypeChange"
          data-type="4"
        >é—²èŠçŒæ°´</view>
      </view>
    </scroll-view>
    
    <view class="sort-btn" bindtap="toggleSort">
      <text>{{currentSort === 'new' ? 'æœ€æ–°' : 'æœ€çƒ­'}}</text>
      <text class="sort-icon">â†“</text>
    </view>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <scroll-view 
    class="post-list" 
    scroll-y 
    enhanced 
    show-scrollbar="{{false}}"
    bindscrolltolower="loadMore"
    refresher-enabled
    bindrefresherrefresh="onRefresh"
    refresher-triggered="{{isRefreshing}}"
  >
    <view 
      class="post-card"
      wx:for="{{posts}}"
      wx:key="id"
      bindtap="goToDetail"
      data-id="{{item.id}}"
    >
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="post-header">
        <image class="user-avatar" src="{{item.userAvatar || '/images/default-avatar.png'}}" mode="aspectFill"/>
        <view class="user-info">
          <text class="user-nickname">{{item.userNickname}}</text>
          <text class="post-time">{{item.createTimeStr}}</text>
        </view>
        <view class="type-tag tag-{{item.type}}">{{item.typeText}}</view>
      </view>

      <!-- å¸–å­å†…å®¹ -->
      <text class="post-title">{{item.title}}</text>
      <text class="post-content text-ellipsis-2">{{item.content}}</text>

      <!-- å›¾ç‰‡é¢„è§ˆ -->
      <view class="post-images" wx:if="{{item.images && item.images.length > 0}}">
        <image 
          wx:for="{{item.images}}"
          wx:for-item="img"
          wx:key="*this"
          wx:if="{{index < 3}}"
          class="post-image {{item.images.length === 1 ? 'single' : ''}}"
          src="{{img}}"
          mode="aspectFill"
        />
        <view class="image-count" wx:if="{{item.images.length > 3}}">+{{item.images.length - 3}}</view>
      </view>

      <!-- äº’åŠ¨æ•°æ® -->
      <view class="post-footer">
        <view class="stat-item">
          <text class="stat-icon">ğŸ‘</text>
          <text class="stat-num">{{item.viewCount || 0}}</text>
        </view>
        <view class="stat-item" catchtap="toggleLike" data-id="{{item.id}}" data-index="{{index}}">
          <text class="stat-icon {{item.isLiked ? 'liked' : ''}}">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="stat-num">{{item.likeCount || 0}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-icon">ğŸ’¬</text>
          <text class="stat-num">{{item.commentCount || 0}}</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{!loading && posts.length === 0}}">
      <image class="empty-icon" src="/images/empty.png" mode="aspectFit"/>
      <text class="empty-text">æš‚æ— å¸–å­</text>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{posts.length > 0}}">
      <text wx:if="{{hasMore}}">åŠ è½½ä¸­...</text>
      <text wx:else>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </scroll-view>

  <!-- å‘å¸ƒæŒ‰é’® -->
  <view class="publish-btn" bindtap="goToPublish">
    <text class="publish-icon">+</text>
  </view>
</view>
