<!--pages/community/detail/detail.wxml-->
<view class="detail-page">
  <!-- å¸–å­å†…å®¹ -->
  <scroll-view 
    class="content-scroll" 
    scroll-y 
    enhanced 
    show-scrollbar="{{false}}"
    bindscrolltolower="loadMoreComments"
  >
    <!-- å¸–å­ä¸»ä½“ -->
    <view class="post-detail">
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="post-header">
        <image class="user-avatar" src="{{post.userAvatar || '/images/default-avatar.png'}}" mode="aspectFill"/>
        <view class="user-info">
          <text class="user-nickname">{{post.userNickname}}</text>
          <text class="post-time">{{post.createTimeStr}}</text>
        </view>
        <view class="type-tag tag-{{post.type}}">{{post.typeText}}</view>
      </view>

      <!-- å¸–å­æ ‡é¢˜ -->
      <text class="post-title">{{post.title}}</text>

      <!-- å¸–å­å†…å®¹ -->
      <view class="post-content">
        <text>{{post.content}}</text>
      </view>

      <!-- å¸–å­å›¾ç‰‡ -->
      <view class="post-images" wx:if="{{post.images && post.images.length > 0}}">
        <image 
          wx:for="{{post.images}}"
          wx:key="*this"
          class="post-image"
          src="{{item}}"
          mode="widthFix"
          bindtap="previewImage"
          data-current="{{item}}"
        />
      </view>

      <!-- äº’åŠ¨æ•°æ® -->
      <view class="post-stats">
        <view class="stat-item">
          <text class="stat-icon">ğŸ‘</text>
          <text class="stat-num">{{post.viewCount || 0}} æµè§ˆ</text>
        </view>
        <view class="stat-item" bindtap="toggleLike">
          <text class="stat-icon {{post.isLiked ? 'liked' : ''}}">{{post.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="stat-num">{{post.likeCount || 0}} ç‚¹èµ</text>
        </view>
        <view class="stat-item">
          <text class="stat-icon">ğŸ’¬</text>
          <text class="stat-num">{{post.commentCount || 0}} è¯„è®º</text>
        </view>
      </view>
    </view>

    <!-- è¯„è®ºåŒº -->
    <view class="comment-section">
      <view class="section-header">
        <text class="section-title">è¯„è®º ({{comments.length}})</text>
      </view>

      <!-- è¯„è®ºåˆ—è¡¨ -->
      <view class="comment-list">
        <view 
          class="comment-item"
          wx:for="{{comments}}"
          wx:key="id"
        >
          <image class="comment-avatar" src="{{item.userAvatar || '/images/default-avatar.png'}}" mode="aspectFill"/>
          <view class="comment-body">
            <view class="comment-header">
              <text class="comment-nickname">{{item.userNickname}}</text>
              <text class="comment-time">{{item.createTimeStr}}</text>
            </view>
            <text class="comment-content">{{item.content}}</text>
            
            <!-- å›å¤ -->
            <view class="reply-list" wx:if="{{item.replies && item.replies.length > 0}}">
              <view 
                class="reply-item"
                wx:for="{{item.replies}}"
                wx:for-item="reply"
                wx:key="id"
              >
                <text class="reply-nickname">{{reply.userNickname}}</text>
                <text class="reply-arrow" wx:if="{{reply.replyToNickname}}">å›å¤</text>
                <text class="reply-target" wx:if="{{reply.replyToNickname}}">{{reply.replyToNickname}}</text>
                <text class="reply-content">ï¼š{{reply.content}}</text>
              </view>
            </view>

            <view class="comment-actions">
              <text class="action-btn" bindtap="replyComment" data-id="{{item.id}}" data-nickname="{{item.userNickname}}">å›å¤</text>
              <view class="like-btn" bindtap="likeComment" data-id="{{item.id}}" data-index="{{index}}">
                <text>{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
                <text>{{item.likeCount || 0}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-comment" wx:if="{{!loading && comments.length === 0}}">
          <text>æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§~</text>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view class="load-more" wx:if="{{comments.length > 0}}">
          <text wx:if="{{hasMore}}">åŠ è½½ä¸­...</text>
          <text wx:else>æ²¡æœ‰æ›´å¤šè¯„è®ºäº†</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨è¯„è®ºè¾“å…¥ -->
  <view class="comment-input-bar">
    <input 
      class="comment-input"
      placeholder="{{replyTo ? 'å›å¤ ' + replyTo.nickname : 'å†™è¯„è®º...'}}"
      value="{{commentContent}}"
      bindinput="onCommentInput"
      confirm-type="send"
      bindconfirm="submitComment"
      focus="{{inputFocus}}"
      bindblur="onInputBlur"
    />
    <view class="send-btn {{commentContent ? 'active' : ''}}" bindtap="submitComment">
      å‘é€
    </view>
  </view>
</view>
